<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<changeSet id="0001" author="ricko">
		<createTable tableName="bounce_admin">
			<column name="admin_email" type="varchar(128)">
				<constraints nullable="false" unique="true" primaryKey="true" />
			</column>
			<column name="admin_name" type="varchar(64)" />
		</createTable>
		<createTable tableName="bounce_link">
			<column name="link_id" type="int" autoIncrement="true" startWith="1">
				<constraints nullable="false" primaryKey="true" primaryKeyName="PK_bounce_link_id" />
			</column>
			<column name="link_name" type="varchar(24)" remarks="Short URL-safe slug">
				<constraints nullable="false" unique="true" uniqueConstraintName="UX_bounce_link_name" />
			</column>
			<column name="link_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="link_hits" type="int" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="link_peeks" type="int" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="link_to" type="varchar(1000)" remarks="Destination URL">
				<constraints nullable="false" />
			</column>
			<column name="link_title" type="varchar(200)" remarks="Human-readable title or description" />
		</createTable>
		<createTable tableName="bounce_hit">
			<column name="hit_id" type="int" autoIncrement="true" startWith="1">
				<constraints nullable="false" primaryKey="true" primaryKeyName="PK_bounce_hit_id" />
			</column>
			<column name="hit_link" type="int">
				<constraints referencedTableName="bounce_link" referencedColumnNames="link_id" foreignKeyName="FK_bounce_hit_link_id" />
			</column>
			<column name="hit_dt" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="hit_ip4" type="int" remarks="Remote address IPv4 in big-endian form">
				<constraints nullable="false" />
			</column>
			<column name="hit_ref" type="varchar(255)" remarks="Referer, if provided" />
			<column name="hit_ua" type="varchar(255)" remarks="User-Agent, if provided" />
			<column name="hit_cookie" type="varchar(32)" remarks="Tracking cookie, if provided" />
			<column name="hit_ua_vendor" type="varchar(12)" remarks="User-Agent vendor, if provided" />
			<column name="hit_ua_major" type="int" remarks="User-Agent major version, if provided" />
			<column name="hit_ua_ver" type="varchar(8)" remarks="User-Agent version, if provided" />
			<column name="hit_mobile" type="boolean" remarks="If UA is mobile" />
			<column name="hit_bot" type="boolean" remarks="If UA is bot" />
			<column name="hit_ip6" type="blob" remarks="Remote address IPv6" />
		</createTable>
		<createTable tableName="bounce_ua">
			<column name="ua_priority" type="int">
				<constraints primaryKey="true" primaryKeyName="PK_bounce_ua_priority" nullable="false" />
			</column>
			<column name="ua_regex" type="varchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="ua_vendor" type="varchar(16)" />
			<column name="ua_major" type="varchar(8)" />
			<column name="ua_ver" type="varchar(8)" />
			<column name="ua_mobile" type="varchar(8)" />
			<column name="ua_bot" type="varchar(8)" />
		</createTable>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="200" />
			<column name="ua_regex" value="Android.*\sFirefox/((\d+)\.\d+)" />
			<column name="ua_vendor" value="Firefox" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_mobile" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="250" />
			<column name="ua_regex" value="Opera/((\d+)\.\d+).*Opera Mini" />
			<column name="ua_vendor" value="Opera" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_mobile" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="300" />
			<column name="ua_regex" value="Opera/9.*Version/((\d+)\.\d+)" />
			<column name="ua_vendor" value="Opera" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_mobile" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="320" />
			<column name="ua_regex" value="TweetmemeBot" />
			<column name="ua_vendor" value="Misc Bot" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="350" />
			<column name="ua_regex" value="(Firefox|Opera)/((\d+)\.\d+)" />
			<column name="ua_vendor" value="-1" />
			<column name="ua_major" value="-3" />
			<column name="ua_ver" value="-2" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="400" />
			<column name="ua_regex" value="(MSIE) ((\d+)\.\d+)" />
			<column name="ua_vendor" value="-1" />
			<column name="ua_major" value="-3" />
			<column name="ua_ver" value="-2" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="450" />
			<column name="ua_regex" value="\sChrome/((\d+)\.\d+)" />
			<column name="ua_vendor" value="Chrome" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="500" />
			<column name="ua_regex" value="\sVersion/((\d+)\.\d+)\S*\sMobile/?\S*\sSafari/\d" />
			<column name="ua_vendor" value="Safari" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_mobile" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="510" />
			<column name="ua_regex" value="(iPhone|iPad).*AppleWebKit/\d.*Mobile/" />
			<column name="ua_vendor" value="Safari" />
			<column name="ua_mobile" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="550" />
			<column name="ua_regex" value="\sVersion/((\d+)\.\d+).*\sSafari/\d" />
			<column name="ua_vendor" value="Safari" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="600" />
			<column name="ua_regex" value="\sSafari/\d" />
			<column name="ua_vendor" value="Safari" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="800" />
			<column name="ua_regex" value="Yahoo Slurp" />
			<column name="ua_vendor" value="Yahoo" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="805" />
			<column name="ua_regex" value="Googlebot/((\d+)\.\d+)" />
			<column name="ua_vendor" value="Google" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="806" />
			<column name="ua_regex" value="Twitterbot/((\d+)\.\d+)" />
			<column name="ua_vendor" value="Twitter" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="840" />
			<column name="ua_regex" value="libcurl/((\d+)\.\d+)" />
			<column name="ua_vendor" value="Misc Bot" />
			<column name="ua_major" value="-2" />
			<column name="ua_ver" value="-1" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="850" />
			<column name="ua_regex" value="urlresolver|PycURL|PostRank|hourlypress|Summify|NING|LongURL|MetaURI" />
			<column name="ua_vendor" value="Misc Bot" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_ua">
			<column name="ua_priority" valueNumeric="860" />
			<column name="ua_regex" value="^(Java/|PostPost)" />
			<column name="ua_vendor" value="Misc Bot" />
			<column name="ua_bot" value="1" />
		</insert>
		<insert tableName="bounce_link">
			<column name="link_name" value="" />
			<column name="link_created" valueDate="2010-12-27 18:44:48" />
			<column name="link_to" value="https://rickosborne.org/" />
			<column name="link_title" value="rick osborne dot org" />
		</insert>
	</changeSet>

</databaseChangeLog>